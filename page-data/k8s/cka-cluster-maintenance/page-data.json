{"componentChunkName":"component---src-templates-blog-post-js","path":"/k8s/cka-cluster-maintenance/","result":{"data":{"site":{"siteMetadata":{"title":"Heeye Blog","author":"heeye","siteUrl":"https://heeyeah.github.io","comment":{"disqusShortName":"","utterances":"heeyeah/heeyeah.github.io"},"sponsor":{"buyMeACoffeeId":"heeyeah"}}},"markdownRemark":{"id":"5bc31cd9-d5a6-5964-8bc3-5ee11575a083","excerpt":"📌Cluster Maintenance OS Upgrades Kubernetes Software Versions k8s의 version 체계 {major version}.{minor version}.{patch version} Cluster Upgrade  kubeadm은 kubelet의 업그레이드까지 해주지 않기 때문에, 따로 kubelet upgrade해줘야 함 Master와 node-1(worker)이 있다고 가정했을 때 Backup and Restore Methods ETCD…","html":"<h2 id=\"cluster-maintenance\" style=\"position:relative;\"><a href=\"#cluster-maintenance\" aria-label=\"cluster maintenance permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌Cluster Maintenance</h2>\n<h3 id=\"os-upgrades\" style=\"position:relative;\"><a href=\"#os-upgrades\" aria-label=\"os upgrades permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OS Upgrades</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl cordon my-node      <span class=\"token comment\"># my-node를 스케줄링할 수 없도록 표기</span>\nkubectl drain my-node       <span class=\"token comment\"># 유지 보수를 위해서 my-node를 준비 상태로 비움</span>\nkubectl uncordon my-node    <span class=\"token comment\"># my-node를 스케줄링할 수 있도록 표기</span></code></pre></div>\n<h3 id=\"kubernetes-software-versions\" style=\"position:relative;\"><a href=\"#kubernetes-software-versions\" aria-label=\"kubernetes software versions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubernetes Software Versions</h3>\n<p>k8s의 version 체계</p>\n<ul>\n<li>{major version}.{minor version}.{patch version}</li>\n</ul>\n<h3 id=\"cluster-upgrade\" style=\"position:relative;\"><a href=\"#cluster-upgrade\" aria-label=\"cluster upgrade permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cluster Upgrade</h3>\n<p><code class=\"language-text\">kubeadm upgrade plan</code></p>\n<p>kubeadm은 kubelet의 업그레이드까지 해주지 않기 때문에, 따로 kubelet upgrade해줘야 함</p>\n<p>Master와 node-1(worker)이 있다고 가정했을 때</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">(</span>Master<span class=\"token punctuation\">)</span> $ kubectl drain node-1\n\n<span class=\"token punctuation\">(</span>node-1<span class=\"token punctuation\">)</span> $ <span class=\"token function\">apt-get</span> upgrade -y <span class=\"token assign-left variable\">kubeadm</span><span class=\"token operator\">=</span><span class=\"token number\">1.12</span>.0-00\n\n<span class=\"token punctuation\">(</span>node-1<span class=\"token punctuation\">)</span> $ <span class=\"token function\">apt-get</span> upgrade -y <span class=\"token assign-left variable\">kubelet</span><span class=\"token operator\">=</span><span class=\"token number\">1.12</span>.0-00\n\n<span class=\"token punctuation\">(</span>node-1<span class=\"token punctuation\">)</span> $ kubeadm upgrade node config --kubelet-version v1.12.0\n\n<span class=\"token punctuation\">(</span>node-1<span class=\"token punctuation\">)</span> $ systemctl restart kubelet\n\n<span class=\"token punctuation\">(</span>Master<span class=\"token punctuation\">)</span> $ kubectl uncordon node-1</code></pre></div>\n<h3 id=\"backup-and-restore-methods\" style=\"position:relative;\"><a href=\"#backup-and-restore-methods\" aria-label=\"backup and restore methods permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Backup and Restore Methods</h3>\n<h4 id=\"etcd-백업과-복구\" style=\"position:relative;\"><a href=\"#etcd-%EB%B0%B1%EC%97%85%EA%B3%BC-%EB%B3%B5%EA%B5%AC\" aria-label=\"etcd 백업과 복구 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ETCD 백업과 복구</h4>\n<p>이 내용은 공식 문서에 나오지 않는다. 따라서 반드시 암기 해야 한다. 긴 명령어를 완전히 암기한다기 보다 눈에 익혀두는 게 맞겠다.\n일단 —help 명령어를 쳐보면 기본값을 써도 되는 것도 있고, 문제에서 Certificates 파일 경로를 알려주기 때문에 눈치가 있다면 그것들에 해당하는 옵션만 넣어도 쉽게 해결할 수 있다.</p>\n<p>ETCD 스냅샷 백업하기</p>\n<p><code class=\"language-text\">etcdctl snapshot save -h</code> 이걸로 먼저 help 스크립트 볼 것!</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Since our ETCD database is TLS-Enabled, the following options are mandatory:\n\n--cacert           verify certificates of TLS-enabled secure servers using this CA bundle\n\n--cert             identify secure client using this TLS certificate file\n\n--endpoints=[127.0.0.1:2379]          This is the default as ETCD is running on master node and exposed on localhost 2379.\n\n--key              identify secure client using this TLS key file</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ etcdctl \\\n  # --endpoints=https://[127.0.0.1]:2379 \\  # 기본값\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key \\\n  snapshot save /tmp/some-snapshot.db</code></pre></div>\n<p>ETCD 스냅샷 복구하기</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ etcdctl \\\n  # --endpoints=https://[127.0.0.1]:2379 \\  # 기본값\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key \\\n  --name=master \\\n  --data-dir /var/lib/etcd-from-backup \\\n  --initial-cluster=master=https://127.0.0.1:2380 \\\n  --initial-advertise-peer-urls=https://127.0.0.1:2380 \\\n  snapshot restore /tmp/some-snapshot.db</code></pre></div>\n<hr>\n<h3 id=\"certification-exam-tip\" style=\"position:relative;\"><a href=\"#certification-exam-tip\" aria-label=\"certification exam tip permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✨Certification Exam Tip!</h3>\n<p>Here’s a quick tip. In the exam, you won’t know if what you did is correct or not as in the practice tests in this course. You must verify your work yourself. For example, if the question is to create a pod with a specific image, you must run the the kubectl describe pod command to verify the pod is created with the correct name and correct image.</p>\n<br/>\n<br/>\n<h3 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h3>\n<p><a href=\"https://www.udemy.com/course/certified-kubernetes-administrator-with-practice-tests/learn/lecture/16214516#content\">CKA 강의 by udemy</a></p>\n<p><a href=\"https://jonnung.dev/kubernetes/2020/08/24/cka-challenge-and-spoiler-free-tips/\">조은우 개발 블로그-CKA후기</a></p>","frontmatter":{"title":"[CKA] Section6. Cluster Maintenance","date":"August 01, 2021"}}},"pageContext":{"slug":"/k8s/cka-cluster-maintenance/","previous":{"fields":{"slug":"/k8s/cka-application-lifecycle-management/"},"frontmatter":{"title":"[CKA] Section5. Application Lifecycle Management","category":"k8s","draft":false}},"next":{"fields":{"slug":"/k8s/cka-security/"},"frontmatter":{"title":"[CKA] Section7. Security","category":"k8s","draft":false}}}},"staticQueryHashes":["3128451518","521680639"]}