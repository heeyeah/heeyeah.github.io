---
title: "μΈμ¦μ„λ” μ–΄λ–»κ² λ™μ‘ν•λ” κ²ƒμΌκΉ?"
date: '2019-04-21 21:00:00'
category: dev
draft: false
---

κ°λ°μλ¶„λ“¤κ³Ό μμ μ£Όμ λ΅ λ°ν‘ν•λ” μ¤ν„°λ””μ— μ°Έμ—¬ν•κ³  μλ‹¤. μ”μƒ μ—…λ¬΄λ„ AWSμ— kubernetesλ¥Ό μ¬λ ¤μ„ ingressλ΅ ambassadorλ¥Ό μ‚¬μ©ν•λ”λ° httpsμ— λ€ν• μ²λ¦¬λ¥Ό μ–΄λ–»κ² ν•΄μ•Όν•λ‚π―λ¥Ό μ£Όμ λ΅ νμλ¥Ό ν–μ—λ”λ° ~~(μ •ν™•νλ” μμ„λ‹μ΄ searchν• λ‚΄μ©μ„ λ“¤μ€ κ²ƒμ΄μ§€λ§)~~ μ¤ν„°λ””μ—μ„λ„ μΈμ¦μ„ κ΄€λ ¨ λ‚΄μ©μ„ λ“¤μ–΄μ„ λ„μ›€μ΄ λ§μ΄ λλ‹¤.

<br/>
## μ•”νΈν™” λ°©μ‹
#### λ€μΉ­ν‚¤
λ€μΉ­ν‚¤λ” λ§ κ·Έλ€λ΅ `heeye`λΌλ” ν‚¤λ΅ μ•”νΈν™”λ¥Ό ν•λ©΄, λ³µνΈν™”ν•  λ• `heeye`λΌλ” ν‚¤λ¥Ό μ‚¬μ©ν•λ” λ°©μ‹μ΄λ‹¤.

#### κ³µκ°ν‚¤, κ°μΈν‚¤
λ€μΉ­ν‚¤λ¥Ό μ‚¬μ©ν–μ„ λ• λ‹¨μ μ΄ `heeye`λΌλ” ν‚¤λ¥Ό λ„κµ°κ°€ μ•κΈ°λΌλ„ ν•λ©΄, μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό λ³µνΈν™”ν•  μ μλ‹¤. λ³΄μ•μ— μ·¨μ•½ν•λ‹¤! μ΄ λ‹¨μ μ„ λ³΄μ™„ν•κΈ° μ„ν• κ² κ³µκ°ν‚¤ λ°©μ‹μ„ μ‚¬μ©ν•λ‹¤.<br/>
κ³µκ°ν‚¤ λ°©μ‹μ€ κ° μ‚¬μ©μκ°€ λ‘ κ°μ ν‚¤λ¥Ό λ¶€μ—¬λ°›λ”λ°, ν•λ‚ *(κ³µκ°ν‚¤, public key)* λ” κ³µκ°λκ³  λ‹¤λ¥Έ ν•λ‚ *(κ°μΈν‚¤,λΉ„λ°€ν‚¤ private key)* λ” μ‚¬μ©μμ— μν•΄ λΉ„λ°€λ¦¬μ— κ΄€λ¦¬λμ•Ό ν•λ‹¤.<br/>
λ’¤μ— μ •λ¦¬ν•  μ „μμ„λ…κ³Ό μ „μλ΄‰ν¬μ μ›λ¦¬λ¥Ό μ΄ν•΄ν•λ”λ° μ μΌ ν•„μ”ν• κ°λ…μ€ μ•„λμ™€ κ°™λ‹¤.
>**κ°μΈν‚¤λ΅ μ•”νΈν™”ν•κ±΄ κ³µκ°ν‚¤λ΅ λ³µνΈν™” κ°€λ¥, κ³µκ°ν‚¤λ΅ μ•”νΈν™”ν•κ±΄ κ°μΈν‚¤λ΅ λ³µνΈν™” κ°€λ¥**

μ΄λ¬ν• μ›λ¦¬λ΅

- μ „μμ„λ… (λ¶€μΈλ°©μ§€) : κ°μΈν‚¤λ΅ μ•”νΈν™”ν• κ²ƒ
- μ „μλ΄‰ν¬ (λ°μ΄ν„°λ³΄μ•, λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•κ³  μ‹¶μ„ λ•) : κ³µκ°ν‚¤λ΅ μ•”νΈν™”ν• κ²ƒ


κ³µκ°ν‚¤ μ•”νΈ μ‹μ¤ν…μ λ€ν‘μ μΈ μ•κ³ λ¦¬μ¦μ€ RSAμ΄λ‹¤. RSAλ” κ³µκ°ν‚¤ μ•”νΈμ‹μ¤ν…μ ν•λ‚λ΅, μ•”νΈν™”λΏλ§ μ•„λ‹λΌ μ „μμ„λ…μ΄ κ°€λ¥ν• μµμ΄μ μ•κ³ λ¦¬μ¦μΌλ΅ μ•λ ¤μ Έμλ‹¤. [μ„ν‚¤λ°±κ³Ό](https://ko.wikipedia.org/wiki/RSA_%EC%95%94%ED%98%B8)

<br/><br/>
## μ „μμ„λ…, μ „μλ΄‰ν¬μ— λ€ν•΄

#### μ „μμ„λ…
μ „μμ„λ…μ΄λΌ ν•¨μ€, μ„λ…μλ¥Ό ν™•μΈν•κ³  μ„λ…μκ°€ λ‹Ήν•΄ μ „μλ¬Έμ„μ— μ„λ…ν–λ‹¤λ” μ‚¬μ‹¤μ„ λ‚νƒ€λ‚΄λ” λ° μ΄μ©ν•λ ¤κ³ , νΉμ • μ „μλ¬Έμ„μ— μ²¨λ¶€λκ±°λ‚ λ…Όλ¦¬μ μΌλ΅ κ²°ν•©λ μ „μμ  ν•νƒμ μ •λ³΄λ¥Ό λ§ν•λ‹¤.

κ³µκ° ν‚¤ κΈ°λ° κµ¬μ΅°(PKI) κΈ°μ μΈ΅λ©΄μ—μ„ μ „μμ„λ…μ΄λ€ μ „μλ¬Έμ„μ ν•΄μ‹(HASH)κ°’μ„ μ„λ…μμ κ°μΈν‚¤(μ „μμ„λ…μƒμ„±μ •λ³΄)λ΅ λ³€ν™(μ•”νΈν™”)ν• κ²ƒμΌλ΅μ„ RSAμ‚¬μ—μ„ λ§λ“  PKCS#7 μ ν‘μ¤€μ΄ λ„λ¦¬ μ‚¬μ©λκ³  μλ‹¤.
μ¦‰, μ›λμ λ¬Έμ„ λ‚΄μ©μ„ AλΌκ³  ν•λ©΄ Aμ ν•΄μ‰¬ κ°’μ„ μ μ•λ ¤μ§„ Hash ν•¨μμΈ SHA1 κ°™μ€ ν•¨μ ν•λ‚λ¥Ό μ •ν•΄ μ΄λ° Hashν•¨μλ΅ λ¬Έμ„ Aμ Hash κ°’μ„ κµ¬ν•κ³  μ΄ Hash κ°’μ„, λ³΄λ‚΄λ” μ‚¬λ(μ² μ)μ Private Key λ΅ μ•”νΈν™” ν•λ‹¤. μ΄λ° λ‹¤μ μ΄λ ‡κ² μ•”νΈν™”λ Hashκ°’μ„ μ›λ λ¬Έμ„ A λμ— μ²¨λ¶€ν•μ—¬ μ΄ λ¬Έμ„ μ „μ²΄λ¥Ό λ°›λ” μ‚¬λ(μν¬)μ—κ² λ³΄λ‚Έλ‹¤. [μ¶μ²](https://ko.wikipedia.org/wiki/%EC%A0%84%EC%9E%90%EC%84%9C%EB%AA%85)

#### μ „μλ΄‰ν¬
μ „μλ΄‰ν¬(ι›»ε­ε°ε¥—, digital envelope)λ€ λ€μΉ­ν‚¤λ¥Ό μ‚¬μ©ν•μ—¬ λ¬Έμ„μ λ‚΄μ©μ„ μ•”νΈν™”ν• ν›„ ν•΄λ‹Ή ν‚¤λ¥Ό μμ‹ μμ κ³µκ°ν‚¤λ¥Ό μ΄μ©ν•μ—¬ λΉ„λ€μΉ­ν‚¤λ΅ λ‹¤μ‹ μ•”νΈν™”ν• κ²ƒμ„ λ§ν•λ‹¤. μ΄λ¥Ό ν†µν•΄ μ•”νΈν™” λ° λ³µνΈν™” μ‹κ°„μ„ λ‹¨μ¶•ν•λ©΄μ„λ„ μμ‹ μ μ΄μ™Έμ—λ” ν•΄λ‹Ή λ¬Έμ„μ— μ ‘κ·Όν•  μ μ—†λ„λ΅ ν•¨μΌλ΅μ¨ κΈ°λ°€λ³΄μ•μ„ λ³΄μ¥ν•λ‹¤. μ „μλ΄‰ν¬ μ•„μ΄λ””μ–΄λ” λ€μΉ­ν‚¤ μ•”νΈν™”μ™€ λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”μ ν•μ΄λΈλ¦¬λ“ μ†μ—μ„ λ‚μ™”λ‹¤. μ „μλ΄‰ν¬λ” κΈ°μ΅΄ μ „μμ„λ… λ°©μ‹μ—μ„ λ³΄μ•μ„±μ΄ λ” ν–¥μƒλ ν•νƒμ΄λ‹¤. λ””μ§€ν„Έλ΄‰ν¬λΌκ³ λ„ ν•λ‹¤. [μ¶μ²](http://wiki.hash.kr/index.php/%EC%A0%84%EC%9E%90%EB%B4%89%ED%88%AC)

<br/>
## μ΄ν•΄λ¥Ό μ„ν• μ΄μ•ΌκΈ°π£
**ν΄λΌμ΄μ–ΈνΈ** μ™€ **μ„λ²„** κ°€ μλ‹¤κ³  κ°€μ •ν•μ. λ‹¤μ–‘ν• ν΄λΌμ΄μ–ΈνΈκ°€ μ΅΄μ¬ν•μ§€λ§, λΈλΌμ°μ €λΌκ³  μƒκ°ν•λ‹¤. μ΄ λΈλΌμ°μ €λ” `https://heeworld.unknownsite.com`μ— μ ‘μ†ν•κ³  μ‹¶λ‹¤. κ·Έλ°λ° httpsν†µμ‹ μ„ μ„ν•΄μ„λ” httpν†µμ‹ μ— λΉ„ν•΄ λ³΄μ•μ μ°¨κ°€ λ” ν•„μ”ν•λ‹¤. λ‚΄κ°€ requestλ¥Ό λ³΄λ‚Έ uriκ°€ μ‹ λΆ°ν• λ§ν• μ„λ²„(?)μΈμ§€ ν™•μΈμ΄ ν•„μ”ν• κ²ƒμ΄λ‹¤.

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μΈμ¦μ„λ¥Ό μ”μ²­ν•λ‹¤.
2. μ„λ²„κ°€ μΈμ¦μ„λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Έλ‹¤. (λ―Ώμ„λ§ν•μ§€ μ•„λ‹μ§€λ” μΈμ¦μ„μ— λ”°λΌ λ‹¤λ¥΄μ§€.)
3. ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„κ°€ λ³΄λ‚Έ μΈμ¦μ„κ°€ λ―Ώμ„λ§ν• μΈμ¦μ„μΈμ§€ ν™•μΈ ν›„ ν†µμ‹ μ„ μ‹μ‘ν•λ‹¤.
<br/>**β—οΈμ—¬κΈ°μ„ μ¤‘μ”β—οΈ**
<br/> 1. ν΄λΌμ΄μ–ΈνΈλ” **μ‹ λΆ°ν•  λ§ν• μΈμ¦κΈ°κ΄€(Root CA)μ΄λ‚ μ¤‘κ°„ μΈμ¦κΈ°κ΄€** μ μ •λ³΄λ¥Ό κ°€μ§€κ³  μλ‹¤.
<br/> 2. ν΄λΌμ΄μ–ΈνΈλ” μ΄ μΈμ¦κΈ°κ΄€λ“¤μ κ³µκ°ν‚¤λ¥Ό κ°€μ§€κ³  μμΌλ©°, μ„λ²„κ°€ λ³΄λ‚Έ μΈμ¦μ„κ°€ μ–΄λ””μ„ λ°κΈ‰λ κ±΄μ§€ ν™•μΈν• ν›„ **μμ‹ μ΄ μ•κ³  μλ” κ³µκ°ν‚¤λ΅ μΈμ¦μ„μ— μλ” μ „μμ„λ…μ„ λ³µνΈν™”** ν•λ‹¤.
<br/>3. κ·ΈλΌ hashκ°’μ΄ ν­ ν€μ–΄λ‚μ¤λ”λ°, μΈμ¦μ„μ λ‹¤λ¥Έ μ •λ³΄λ¥Ό λ™μΌν• hash ν•¨μλ΅ hashκ°’μ„ λ§λ“¤κ³  [λ‘ hashκ°’μ΄ λ‘κ°™μ€ μ§€ λΉ„κµ](#hash-κ°’μ„-λ¨μ) ν•λ‹¤.
<br/>4. λ§μ•½ κ°’μ΄ κ°™μΌλ©΄ μ΄κ±΄ μ‹ λΆ°ν• λ§ν• μΈμ¦κΈ°κ΄€μ—μ„ λ°κΈ‰ν•κ±°λ„¤! λΌκ³  ν΄λΌμ΄μ–ΈνΈκ°€ μΈμ‹ν•κ³  [ν†µμ‹ μ„ μ‹μ‘ν•μ§€](#ν†µμ‹ μ„-μ‹μ‘ν•μ§€) ν•λ‹¤. κ°’μ΄ κ°™μ§€ μ•μΌλ©΄ μ‹ λΆ°ν•  μ μ—†λ” μ‚¬μ΄νΈλΌλ” κ²½κ³ λ¥Ό λ„μ›μ¤€λ‹¤.

#### μΈμ¦μ„μ—” λ¬΄μ¨ λ‚΄μ©μ΄?
certμ— issueμ •λ³΄, subjectμ •λ³΄, κ³µκ°ν‚¤μ •λ³΄, serial number λ“±μ λ‚΄μ©κ³Ό μ „μμ„λ…μ •λ³΄(sign) **(μ¤‘μ”!)** μ„ ν¬ν•¨ν•κ³  μλ‹¤.

#### hash κ°’μ„ λ¨μ
ν•΄μ‹ ν•¨μμ κ°€μ¥ κΈ°λ³Έμ μΈ μ„±μ§μ€ λ‘ ν•΄μ‹ κ°’μ΄ λ‹¤λ¥΄λ‹¤λ©΄ μ›λμ λ°μ΄ν„°λ„ λ‹¤λ¥΄λ‹¤λ” κ²ƒμ΄λ‹¤. μ΄ νΉμ§•μ€ ν•΄μ‹ ν•¨μκ°€ κ²°μ •μ μ΄κΈ° λ•λ¬Έμ΄λ‹¤. λ°λ€λ΅ ν•΄μ‹ ν•¨μλ” λ‹¨μ‚¬ ν•¨μκ°€ μ•„λ‹λ‹¤. κ°™μ€ ν•΄μ‹ κ°’μ„ κ°–λ”λΌλ„ μ›λμ μ…λ ¥κ°’μ΄ κ°™λ‹¤λ” κ²ƒμ„ μ‹μ‚¬ν•μ§€λ§ λ³΄μ¥ν•΄μ£Όμ§€λ” μ•λ”λ‹¤. μ›λ μ…λ ¥μ ν• λΉ„νΈλ§ λ°”λ€λ”λΌλ„ ν•΄μ‹ ν•¨μμ μ„±μ§λ΅ μΈν•΄ ν•΄μ‹ κ°’μ€ ν¬κ² λ‹¬λΌμ§„λ‹¤.


ν•΄μ‹ ν•¨μλ” μ„μμ κΈΈμ΄λ¥Ό κ°–λ” λ©”μ‹μ§€λ¥Ό μ…λ ¥λ°›μ•„ κ³ μ •λ κΈΈμ΄μ ν•΄μ‹κ°’μ„ μ¶λ ¥ν•λ” ν•¨μμ΄λ‹¤. μ•”νΈ μ•κ³ λ¦¬μ¦μ—λ” ν‚¤κ°€ μ‚¬μ©λμ§€λ§, ν•΄μ‹ ν•¨μλ” ν‚¤λ¥Ό μ‚¬μ©ν•μ§€ μ•μΌλ―€λ΅ κ°™μ€ μ…λ ¥μ— λ€ν•΄μ„λ” ν•­μƒ κ°™μ€ μ¶λ ¥μ΄ λ‚μ¤κ² λλ‹¤.

ν•΄μ‹ ν•¨μλ” μ–΄λ–¤ μ…λ ¥ κ°’μ—λ„ ν•­μƒ κ³ μ •λ κΈΈμ΄μ ν•΄μ‹κ°’μ„ μ¶λ ¥ν•κ³ , μ¶λ ¥λ κ²°κ³Ό κ°’μ„ ν† λ€λ΅ μ…λ ¥κ°’μ„ μ μ¶”ν•  μ μ—†λ” νΉμ§•μ΄ μλ‹¤.

~~μ΄ μ „μμ„λ…μ€ ROOT CAκ°€ certμ— μλ” sign μ •λ³΄λ¥Ό μ μ™Έν•κ³  λ¨λ“  μ •λ³΄λ¥Ό hashλ¥Ό λΈ - sha256 etc. (κ°μΈν‚¤λ΅ μ•”νΈν™”) κ·Έ hashκ°’μ„ κ°μΈν‚¤λ΅ μ•”νΈν™”ν• κ°’μ„ μ „μμ„λ…μΌλ΅ λ¶™μ—¬μ„ certλ¥Ό λ°ν–‰! clientλ” μ΄ certμ μ „μμ„λ…μ„ κ³µκ°ν‚¤λ΅ λ³µνΈν•ν•κ³ , λ‚μ¨ hash κ°’κ³Ό certμ— μλ” μ •λ³΄ hash (sha κ°™μ€κ²ƒ)λ¬κ±Έ λΉ„κµν•΄μ„ νλ³„~~

#### ν†µμ‹ μ„ μ‹μ‘ν•μ§€
μ „μλ΄‰ν¬. λ§¤λ² ν†µμ‹ ν•  λ•λ§λ‹¤ μΈμ¦μ„λ¥Ό ν™•μΈν•  μ μ—†μΌλ‹ λ°μ΄ν„°λ¥Ό λ³΄λ‚Ό λ• λ€μΉ­ν‚¤λ¥Ό κ³µκ°ν‚¤λ΅ μ•”νΈν™”ν•΄μ„ λ°μ΄ν„°λ‘ κ°™μ΄ λμ§„λ‹¤! (μ΄ λ• λ°μ΄ν„°λ” λ€μΉ­ν‚¤λ΅ μ•”νΈν™”ν• κ²ƒ) μ„λ²„λ” κ³µκ°ν‚¤λ΅ μ•”νΈν™”λ λ€μΉ­ν‚¤λ¥Ό κ°μΈν‚¤λ΅ λ³µνΈν™”ν•΄μ„ λ€μΉ­ν‚¤λ¥Ό μ–»μ–΄λ‚΄κ³ , κ·Έ λ°μ΄ν„°λ¥Ό λ€μΉ­ν‚¤λ΅ λ³µνΈν™”ν•΄μ„ μ •λ³΄λ¥Ό κ°–λ”λ‹¤.
